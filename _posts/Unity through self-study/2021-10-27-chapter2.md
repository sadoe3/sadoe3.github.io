---
title: "Coroutine"

categories:
    - unity-self

tags:
    - [Game Engine, Unity, Coroutine]

toc: true
toc_label: "목차"
toc_sticky: true

date: 2021-10-27
---

## About coroutine
- Unity에서 코루틴은 특정시점에서 작동을 멈출수 있는 함수를 말합니다.
- 멈추고 다시 동작을 재개할 때까지 걸리는 시간은 다양하게 설정할 수 있습니다.
    - ex: 다음 프레임, 특정 초 이후, 특정 조건이 만족할때

## How to use coroutine
- 사용법 자체는 간단합니다.
- 기존에 있던 함수의 return type을 IEnumerator로 바꾸고, 멈추고 싶은 시점에 yield statement를 사용하여 해당 함수를 코루틴 함수로 바꾼 뒤, StartCoroutine method를 통해 해당 코루틴 함수를 호출하시면 됩니다.
``` c#
// example of using coroutine
IEnumerator functionName() {
    for (int i = 0; i < 10; i++) {
        textObject.text = i;
        yield return null;
    }
}
... // some codes
void Awake() {
    ... // some codes
    StartCoroutine("functionName");
}
```

## Yield statements
- 다양한 yield statement를 통해 언제 재개할지 설정할 수 있습니다.
- yield return null;
    - 다음 프레임까지 기다림
- yield return new WaitForSeconds(1f);
    - 게임 시간으로 1초 기다림(time scale에 영향받음)
- yield return new WaitForSecondsRealtime(1f);
    - 실제 시간으로 1초 기다림(time scale에 영향받지 않음)
- yield return new WaitForFixedUpdate();
    - 다음 FixedUpdate 끝날 때까지 기다림
- yield return new WaitForEndOfFrame();
    - 다음 프레임의 Update와 모든 렌더링이 끝날 때까지 기다림
- yield return new WaitUntil();
    - 주어진 delegat이 true값이 될때까지 기다림
- yield break;
    - 현재 처리 중인 코루틴 함수를 나감
- yield return new WaitUntil (System.Func<Bool> predicate);
    - 주어진 predicate이 true가 될때까지 기다림

## How to pass arguments
- 코루틴 함수에게 argument를 보내는 방법은 크게 3가지가 있습니다.
- Argument가 없는 경우
    - 이런 경우에는 위에 예제에서 사용했던것 처럼, string value안에 함수의 이름을 적어서, StartCoroutine()에 보내시면 됩니다.
    - ex: StartCoroutine(“functionName”);
- Argument가 1개인 경우
    - Argument가 없는 경우의 사용법과 동일하며, StartCoroutine()의 두번째 argument로 코루틴 함수의 argument를 전달하시면 됩니다.
    - ex: StartCoroutine(“functionName”, argA);
- Argument가 여러 개인 경우
    - 함수의 이름을 string value로 전달하는 것이 아니라, 코루틴 함수를 여러 개의 argument들로 호출한 후, 해당 함수의 return value를 StartCoroutine()의 argument로 전달하시면 됩니다.
    - ex: StartCoroutine(functionName(argA, argB, argC));

## When to use coroutines
- 다양한 상황에서 사용할 수 있지만, 다음은 코루틴 함수가 사용되는 대표적인 상황들입니다.
- 특정한 주기를 기반으로 반복적으로 실행되는 상황
- 특정 조건이 만족되어야 실행되는 상황
- 그래서 보통 코루틴은 반복문으로 만들고, Awake나 Start method에서 call을 한다

[맨 위로 이동하기](#){: .btn .btn--primary }{: .align-right}