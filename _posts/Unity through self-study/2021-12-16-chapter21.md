---
title: "How to make loading screen in Unity"

categories:
    - unity-self

tags:
    - [Game Engine, Unity, loading]

toc: true
toc_label: "목차"
toc_sticky: true

date: 2021-12-16
---

## How to make loading screen in Unity
이 [영상](https://solution94.tistory.com/75)을 바탕으로 포스팅 했습니다. <br>
- 우선 일반적인 popup object를 만드는 것처럼 loading popup을 만든다. 
- 이후 scene manager같은 scene이 넘어가도 지워지지 않을 object를 만든다.
    - 위 영상에서는 이건 안한거 같은데, 어차피 scene단위로 넘어가도 정보를 갖고있으려면 이렇게 구현하는게 좋다.
- 즉, loading popup object에 들어갈 script는 다음과 같이 만들어주면 된다.
```c#
using UnityEngine;
using Michsky.UI.ModernUIPack;
public class LoadingPopup : MonoBehaviour
{
    [ReadOnly] public ProgressBar progressBar;
    private void Awake() {
        LoadingPopup[] objects = FindObjectsOfType<LoadingPopup>();
        if(objects.Length > 1)
            Destroy(gameObject);
        else {
            progressBar = GetComponentInChildren<ProgressBar>();
            DontDestroyOnLoad(gameObject);
        }
    }
}
```
- 이 코드는 `Modern UI pack`에 있는 progress bar를 사용한 loading popup을 `DontDestroyOnLoad`로 만들어서, scene이 전환되도 계속 하나의 object만 game 내에 존재하도록 해준다.
- 또한, scene manager object에 들어갈 script는 다음과 같이 만들어주면 된다.
```c#
using System.Collections;
using UnityEngine;
using UnityEngine.SceneManagement;
public class MySceneManager : MonoBehaviour
{
    [ReadOnly] public static MySceneManager instance;
    [ReadOnly] public string curSceneName;
    ... // other data members
    [ReadOnly, SerializeField] private LoadingPopup loadingPopup;
    [ReadOnly, SerializeField] private bool isLoadingPopupDisabled;
    private WaitForSeconds waitTimeForLoading;
    ... // other data members
    private void Awake() {
        MySceneManager[] objects = FindObjectsOfType<MySceneManager>();
        if(objects.Length > 1)
            Destroy(gameObject);
        else {
            instance = this;
            curSceneName = "Main Menu Scene";
            waitTimeForLoading = new WaitForSeconds(0.01f);
            DontDestroyOnLoad(gameObject);
        }
    }
    private void Start() {
        loadingPopup = FindObjectOfType<LoadingPopup>();
        DisableLoadingPopup();
        isLoadingPopupDisabled = true;
    }
    public void LoadScene(string sceneName) {
        curSceneName = sceneName;
        StartCoroutine(LoadAsynchronously(sceneName));
    }
    private IEnumerator LoadAsynchronously(string sceneName) {
        EnableLoadingPopup();
        AsyncOperation operation = SceneManager.LoadSceneAsync(sceneName, LoadSceneMode.Single);
        while(!operation.isDone) {
            loadingPopup.progressBar.currentPercent = operation.progress * 100f;
            yield return waitTimeForLoading;
        }
        DisableLoadingPopup();
    }
    public void EnableLoadingPopup() {
        if(isLoadingPopupDisabled) {
            loadingPopup.gameObject.SetActive(true);
            isLoadingPopupDisabled = false;
        }
    }
    public void DisableLoadingPopup() {
        if(!isLoadingPopupDisabled) {
            loadingPopup.gameObject.SetActive(false);
            isLoadingPopupDisabled = true;
        }
    }
```
- 이렇게 구현하게 되면, scene이 바뀔때마다 loading screen이 뜨고, scene이 완전히 바뀌면 자동적으로 loading screen이 꺼지게 된다.
- loading popup script에서 시작할때 자기자신을 꺼주지 않았기때문에, scene manager에서 `start`때 꺼주는걸로 구현했다.
    - 이렇게 해야 scene manager가 loading popup reference를 갖고잇으면서, 시작했을때 loading popup을 꺼주게 설정할수있게 된다.